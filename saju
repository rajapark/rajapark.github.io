<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì „ë¬¸ê°€ ì‚¬ì£¼ëª…ë¦¬ & í† ì •ë¹„ê²° í†µí•© ë¶„ì„ ì‹œìŠ¤í…œ v2.1 (Fix)</title>

  <!-- React 17 (UMD) -->
  <script crossorigin src="https://unpkg.com/react@17.0.2/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17.0.2/umd/react-dom.production.min.js"></script>
  <!-- Babel (JSX íŠ¸ëœìŠ¤íŒŒì¼) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
    *{font-family:'Noto Sans KR',sans-serif}
    @keyframes slideIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .slide-in{animation:slideIn .5s ease-out}
    .gradient-bg{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh}
    .glass-card{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:20px;box-shadow:0 8px 32px rgba(31,38,135,.15)}
    .tooltip{position:relative;display:inline-block;cursor:help}
    .tooltip .tooltip-text{visibility:hidden;width:260px;background:rgba(0,0,0,.9);color:#fff;border-radius:8px;padding:10px;position:absolute;z-index:1000;bottom:125%;left:50%;transform:translateX(-50%);opacity:0;transition:opacity .3s;font-size:13px;line-height:1.4}
    .tooltip:hover .tooltip-text{visibility:visible;opacity:1}
    .element-wood{color:#10b981}.element-fire{color:#ef4444}.element-earth{color:#f59e0b}.element-metal{color:#6b7280}.element-water{color:#3b82f6}
    .tab-active{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff}
    @media print{.no-print{display:none!important}.gradient-bg{background:#fff!important}.glass-card{box-shadow:none!important;border:1px solid #e5e7eb!important}}
    .spinner{border:3px solid rgba(255,255,255,.3);border-top:3px solid #fff;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
  </style>
</head>
<body class="gradient-bg">
  <div id="root"></div>

  <!-- App -->
  <script type="text/babel" data-presets="env,react">
    const App = () => {
      const [activeTab,setActiveTab]=React.useState('input');
      const [formData,setFormData]=React.useState({
        year:1990,month:1,day:1,hour:12,minute:0,gender:'ë‚¨',calendar:'solar'
      });
      const [result,setResult]=React.useState(null);
      const [loading,setLoading]=React.useState(false);
      const [error,setError]=React.useState(null);

      // Chart refs
      const chartRef = React.useRef(null);
      const chartInstanceRef = React.useRef(null);

      // ===== ìƒìˆ˜/í…Œì´ë¸” =====
      const STEMS=["ê°‘","ì„","ë³‘","ì •","ë¬´","ê¸°","ê²½","ì‹ ","ì„","ê³„"];
      const BRANCHES=["ì","ì¶•","ì¸","ë¬˜","ì§„","ì‚¬","ì˜¤","ë¯¸","ì‹ ","ìœ ","ìˆ ","í•´"];
      const ELEMENTS=["ëª©","í™”","í† ","ê¸ˆ","ìˆ˜"];
      const STEM_ELEMENTS={"ê°‘":"ëª©","ì„":"ëª©","ë³‘":"í™”","ì •":"í™”","ë¬´":"í† ","ê¸°":"í† ","ê²½":"ê¸ˆ","ì‹ ":"ê¸ˆ","ì„":"ìˆ˜","ê³„":"ìˆ˜"};
      const BRANCH_ELEMENTS={"ì":"ìˆ˜","ì¶•":"í† ","ì¸":"ëª©","ë¬˜":"ëª©","ì§„":"í† ","ì‚¬":"í™”","ì˜¤":"í™”","ë¯¸":"í† ","ì‹ ":"ê¸ˆ","ìœ ":"ê¸ˆ","ìˆ ":"í† ","í•´":"ìˆ˜"};

      // ì§€ì¥ê°„ (ë³¸/ì¤‘/ì—¬)
      const HIDDEN_STEMS={
        "ì":[{stem:"ê³„",ratio:1.0,type:"ë³¸ê¸°"}],
        "ì¶•":[{stem:"ê¸°",ratio:0.6,type:"ë³¸ê¸°"},{stem:"ê³„",ratio:0.3,type:"ì¤‘ê¸°"},{stem:"ì‹ ",ratio:0.1,type:"ì—¬ê¸°"}],
        "ì¸":[{stem:"ê°‘",ratio:0.6,type:"ë³¸ê¸°"},{stem:"ë³‘",ratio:0.3,type:"ì¤‘ê¸°"},{stem:"ë¬´",ratio:0.1,type:"ì—¬ê¸°"}],
        "ë¬˜":[{stem:"ì„",ratio:1.0,type:"ë³¸ê¸°"}],
        "ì§„":[{stem:"ë¬´",ratio:0.6,type:"ë³¸ê¸°"},{stem:"ì„",ratio:0.3,type:"ì¤‘ê¸°"},{stem:"ê³„",ratio:0.1,type:"ì—¬ê¸°"}],
        "ì‚¬":[{stem:"ë³‘",ratio:0.6,type:"ë³¸ê¸°"},{stem:"ê²½",ratio:0.3,type:"ì¤‘ê¸°"},{stem:"ë¬´",ratio:0.1,type:"ì—¬ê¸°"}],
        "ì˜¤":[{stem:"ì •",ratio:0.7,type:"ë³¸ê¸°"},{stem:"ê¸°",ratio:0.3,type:"ì¤‘ê¸°"}],
        "ë¯¸":[{stem:"ê¸°",ratio:0.6,type:"ë³¸ê¸°"},{stem:"ì •",ratio:0.3,type:"ì¤‘ê¸°"},{stem:"ì„",ratio:0.1,type:"ì—¬ê¸°"}],
        "ì‹ ":[{stem:"ê²½",ratio:0.6,type:"ë³¸ê¸°"},{stem:"ë¬´",ratio:0.3,type:"ì¤‘ê¸°"},{stem:"ì„",ratio:0.1,type:"ì—¬ê¸°"}],
        "ìœ ":[{stem:"ì‹ ",ratio:1.0,type:"ë³¸ê¸°"}],
        "ìˆ ":[{stem:"ë¬´",ratio:0.6,type:"ë³¸ê¸°"},{stem:"ì‹ ",ratio:0.3,type:"ì¤‘ê¸°"},{stem:"ì •",ratio:0.1,type:"ì—¬ê¸°"}],
        "í•´":[{stem:"ì„",ratio:0.7,type:"ë³¸ê¸°"},{stem:"ê°‘",ratio:0.3,type:"ì¤‘ê¸°"}],
      };

      // ì›” ì‹œì‘ ì ˆê¸°(ê°„ì´). ì‹¤ì œ ì„œë¹„ìŠ¤ëŠ” APIì˜ ì ˆì… "ì‹œë¶„ì´ˆ" ë°˜ì˜ ê¶Œì¥
      const MONTH_STARTS = [
        {m:1, d:5,  branch:"ì¶•"}, // å°å¯’
        {m:2, d:4,  branch:"ì¸"}, // ç«‹æ˜¥
        {m:3, d:5,  branch:"ë¬˜"}, // é©šèŸ„
        {m:4, d:4,  branch:"ì§„"}, // æ·¸æ˜
        {m:5, d:5,  branch:"ì‚¬"}, // ç«‹å¤
        {m:6, d:5,  branch:"ì˜¤"}, // èŠ’ç¨®
        {m:7, d:7,  branch:"ë¯¸"}, // å°æš‘
        {m:8, d:7,  branch:"ì‹ "}, // ç«‹ç§‹
        {m:9, d:7,  branch:"ìœ "}, // ç™½éœ²
        {m:10,d:8,  branch:"ìˆ "}, // å¯’éœ²
        {m:11,d:7,  branch:"í•´"}, // ç«‹å†¬
        {m:12,d:7,  branch:"ì"}, // å¤§é›ª
      ];

      // ì‹­ì‹  ì„¤ëª…
      const TEN_GODS_MAP={
        "ë¹„ê²¬":{desc:"ë™ë£ŒÂ·ê²½ìŸì",tip:"ë‚˜ì™€ ê°™ì€ ì˜¤í–‰(ìŒì–‘ ë™ì¼)"},
        "ê²ì¬":{desc:"ë¼ì´ë²ŒÂ·ë„ì „ì",tip:"ë‚˜ì™€ ê°™ì€ ì˜¤í–‰(ìŒì–‘ ë°˜ëŒ€)"},
        "ì‹ì‹ ":{desc:"í‘œí˜„Â·ì°½ì‘",tip:"ë‚´ê°€ ìƒí•˜ëŠ” ì˜¤í–‰(ìŒì–‘ ë™ì¼)"},
        "ìƒê´€":{desc:"ë¹„íŒÂ·ê°œí˜",tip:"ë‚´ê°€ ìƒí•˜ëŠ” ì˜¤í–‰(ìŒì–‘ ë°˜ëŒ€)"},
        "ì •ì¬":{desc:"ì•ˆì •ì  ì¬ë¬¼",tip:"ë‚´ê°€ ê·¹í•˜ëŠ” ì˜¤í–‰(ìŒì–‘ ë°˜ëŒ€)"},
        "í¸ì¬":{desc:"ë³€ë™ì  ì¬ë¬¼",tip:"ë‚´ê°€ ê·¹í•˜ëŠ” ì˜¤í–‰(ìŒì–‘ ë™ì¼)"},
        "ì •ê´€":{desc:"ëª…ì˜ˆÂ·ì§ìœ„",tip:"ë‚˜ë¥¼ ê·¹í•˜ëŠ” ì˜¤í–‰(ìŒì–‘ ë°˜ëŒ€)"},
        "í¸ê´€":{desc:"ë„ì „Â·ë³€í™”",tip:"ë‚˜ë¥¼ ê·¹í•˜ëŠ” ì˜¤í–‰(ìŒì–‘ ë™ì¼)"},
        "ì •ì¸":{desc:"í•™ë¬¸Â·ì§€ì›",tip:"ë‚˜ë¥¼ ìƒí•˜ëŠ” ì˜¤í–‰(ìŒì–‘ ë°˜ëŒ€)"},
        "í¸ì¸":{desc:"íŠ¹ìˆ˜ì¬ëŠ¥",tip:"ë‚˜ë¥¼ ìƒí•˜ëŠ” ì˜¤í–‰(ìŒì–‘ ë™ì¼)"},
      };

      // ì‹ ì‚´ (ì¼ì§€ ê¸°ì¤€ ê°„ì´íŒì •)
      const SINSALS={
        "ì²œì„ê·€ì¸":{
          check:(dayStem,branches)=>{
            const nobles={
              "ê°‘":["ì¶•","ë¯¸"],"ì„":["ì","ì‹ "],"ë³‘":["í•´","ìœ "],"ì •":["í•´","ìœ "],
              "ë¬´":["ì¶•","ë¯¸"],"ê¸°":["ì","ì‹ "],"ê²½":["ì¶•","ë¯¸"],"ì‹ ":["ì¸","ì˜¤"],
              "ì„":["ë¬˜","ì‚¬"],"ê³„":["ë¬˜","ì‚¬"]
            };
            return branches.some(b=>nobles[dayStem]?.includes(b));
          },
          desc:"ê·€ì¸ì˜ ë„ì›€",detail:"ì¤‘ìš”í•  ë•Œ ì£¼ë³€ì˜ í° ë„ì›€ì„ ë°›ê¸° ì‰¬ìš´ ìš´"
        },
        "ë¬¸ì°½ê·€ì¸":{
          check:(dayStem,branches)=>{
            const star={"ê°‘":"ì‚¬","ì„":"ì˜¤","ë³‘":"ì‹ ","ì •":"ìœ ","ë¬´":"ì‹ ","ê¸°":"ìœ ","ê²½":"í•´","ì‹ ":"ì","ì„":"ì¸","ê³„":"ë¬˜"};
            return branches.includes(star[dayStem]);
          },
          desc:"í•™ë¬¸Â·ì˜ˆìˆ ",detail:"í•™ìŠµ/í‘œí˜„ ì¬ëŠ¥ì´ ë‘ë“œëŸ¬ì§"
        },
        "ì—­ë§ˆ":{
          check:(_dayStem,branches)=>{
            // ì¼ì§€(=result.saju.day.branch) ê¸°ì¤€ì˜ ì—­ë§ˆì§€ í¬í•¨ ì—¬ë¶€
            // ê°„ì§€ ë³„ ì—­ë§ˆ: ç”³-å¯…, äº¥-å·³, å¯…-ç”³, å·³-äº¥, å­-åˆ, å¯-é…‰, åˆ-å­, é…‰-å¯, ä¸‘-æœª, è¾°-æˆŒ, æœª-ä¸‘, æˆŒ-è¾°
            const horse = {"ì¸":"ì‹ ","ì‹ ":"ì¸","ì‚¬":"í•´","í•´":"ì‚¬","ì":"ì˜¤","ì˜¤":"ì","ë¬˜":"ìœ ","ìœ ":"ë¬˜","ì¶•":"ë¯¸","ë¯¸":"ì¶•","ì§„":"ìˆ ","ìˆ ":"ì§„"};
            // branches[2]ê°€ ì¼ì§€(ì•„ë˜ì—ì„œ ë³´ì¥)
            const dayBr = branches[2];
            const need = horse[dayBr];
            return need ? branches.includes(need) : false;
          },
          desc:"ì´ë™Â·ë³€í™”",detail:"ì´ë™/ì¶œì¥/ì´ì‚¬ ë“± ë³€í™”ê°€ ë§ì€ íë¦„"
        },
        "í™”ê°œ":{
          check:(_dayStem,branches)=>{
            const canopy={"ì¸":"ìˆ ","ì˜¤":"ìˆ ","ìˆ ":"ìˆ ","ì‚¬":"ì¶•","ìœ ":"ì¶•","ì¶•":"ì¶•","ì‹ ":"ì§„","ì":"ì§„","ì§„":"ì§„","í•´":"ë¯¸","ë¬˜":"ë¯¸","ë¯¸":"ë¯¸"};
            const dayBr=branches[2];
            const need=canopy[dayBr];
            return need? branches.includes(need):false;
          },
          desc:"ì˜ˆìˆ Â·ì¢…êµ",detail:"ì˜ˆìˆ ì„±/ì •ì‹ ì„± ê°•í™”, ê³ ë…ê° ë™ë°˜ ê°€ëŠ¥"
        },
        "ë„í™”ì‚´":{
          check:(_dayStem,branches)=>{
            const yearBr=branches[0];
            const peach={"ì‹ ":"ìœ ","ì":"ìœ ","ì§„":"ìœ ","ì¸":"ë¬˜","ì˜¤":"ë¬˜","ìˆ ":"ë¬˜","í•´":"ì","ë¬˜":"ì","ë¯¸":"ì","ì‚¬":"ì˜¤","ìœ ":"ì˜¤","ì¶•":"ì˜¤"};
            return branches.includes(peach[yearBr]);
          },
          desc:"ë§¤ë ¥Â·ì¸ê¸°",detail:"ëŒ€ì¸ê´€ê³„/ì´ì„±ìš´ ìƒìŠ¹, ê³¼ë„í•œ ì§‘ì°©ì€ ì£¼ì˜"
        }
      };

      // ===== ìŒë ¥ ë³€í™˜ (ë°ëª¨: ê·¼ì‚¬ì¹˜) =====
      class LunarConverter{
        toSolar(y,m,d,isLeap=false){
          const dayOffset=isLeap?30:0;
          const totalDays=Math.round((m-1)*29.5)+d+dayOffset;
          const solar=new Date(y,0,1); solar.setDate(solar.getDate()+totalDays+20);
          return {year:solar.getFullYear(),month:solar.getMonth()+1,day:solar.getDate()};
        }
        toLunar(y,m,d){
          const solar=new Date(y,m-1,d), start=new Date(y,0,1);
          const doy=Math.floor((solar-start)/(24*3600*1000));
          let lm=Math.floor((doy-20)/29.5)+1, ld=((doy-20)%29.5)+1;
          if(lm<=0){lm=12; y--;}
          return {year:y,month:Math.max(1,Math.min(12,lm)),day:Math.max(1,Math.min(30,Math.floor(ld)))};
        }
      }

      // ===== ì‚¬ì£¼ ê³„ì‚° =====
      class SajuCalculator{
        constructor(birthDate,gender,isLunar=false){
          this.gender=gender;
          this.lunar=new LunarConverter();
          this.solarDate=isLunar?(()=>{
            const s=this.lunar.toSolar(birthDate.getFullYear(),birthDate.getMonth()+1,birthDate.getDate());
            return new Date(s.year,s.month-1,s.day,birthDate.getHours(),birthDate.getMinutes());
          })():birthDate;
          this.pillars=this.calculatePillars();
        }

        // ì ˆì… ê°„ì´: í•´ë‹¹ ë‹¬ ì‹œì‘ ì ˆê¸°ì™€ ë‚ ì§œ ë¹„êµ
        getMonthBranchBySolarTerm(date){
          const m=date.getMonth()+1, d=date.getDate();
          const cur=MONTH_STARTS.find(t=>t.m===m);
          if(!cur){return ["","ì¸","ë¬˜","ì§„","ì‚¬","ì˜¤","ë¯¸","ì‹ ","ìœ ","ìˆ ","í•´","ì","ì¶•"][m]||"ì¸";}
          if(d>=cur.d) return cur.branch;
          const prevM=m===1?12:m-1;
          const prev=MONTH_STARTS.find(t=>t.m===prevM);
          return prev? prev.branch : "ì¶•";
        }

        // 60ê°‘ì(ì¼ì£¼): 1984-02-02(ê°‘ì) ê¸°ì¤€ + ì•¼ìì‹œ ë³´ì •(23ì‹œëŠ” ì „ì¼)
        getDayGapja(date){
          const base=new Date(1984,1,2,12,0,0);
          const dateForDay=new Date(date.getTime());
          if(date.getHours()===23){ // ì•¼ìì‹œ: ì „ì¼ë¡œ ë³´ì •
            dateForDay.setDate(dateForDay.getDate()-1);
          }
          const days=Math.floor((dateForDay-base)/(24*3600*1000));
          const idx=((days%60)+60)%60;
          return {stem:STEMS[idx%10],branch:BRANCHES[idx%12]};
        }

        // ì‹œì£¼: (ì¼ê°„idx*2 + ì‹œì§€idx)%10, ì‹œì§€ 2ì‹œê°„ ë‹¨ìœ„(23/0=å­)
        getHourPillar(dayStem,hour){
          const hourBranches=["ì","ì¶•","ì¸","ë¬˜","ì§„","ì‚¬","ì˜¤","ë¯¸","ì‹ ","ìœ ","ìˆ ","í•´"];
          const hourIdx = (hour===23||hour===0)?0: Math.floor((hour+1)/2)%12;
          const dIdx=STEMS.indexOf(dayStem);
          const hStemIdx=(dIdx*2 + hourIdx)%10;
          return {stem:STEMS[hStemIdx],branch:hourBranches[hourIdx]};
        }

        calculatePillars(){
          const dt=this.solarDate; const y=dt.getFullYear();
          // ì…ì¶˜ ê¸°ì¤€ ë…„ì£¼(ê°„ì´)
          const lichun=new Date(y,1,4,0,0,0);
          const adjYear = dt<lichun? y-1 : y;
          const yStemIdx=((adjYear-4)%10+10)%10, yBranchIdx=((adjYear-4)%12+12)%12;

          // ì›”ì£¼
          const mBranch = this.getMonthBranchBySolarTerm(dt);
          const mBranchIdx = BRANCHES.indexOf(mBranch);
          const MONTH_START_STEM_BY_YEAR_STEM=[2,4,6,8,0,2,4,6,8,0]; // ä¸™æˆŠåºšå£¬ç”²
          const mStartStemIdx = MONTH_START_STEM_BY_YEAR_STEM[yStemIdx];
          const mStemIdx = (mStartStemIdx + ((mBranchIdx - BRANCHES.indexOf("ì¸") + 12) % 12)) % 10;

          // ì¼Â·ì‹œì£¼
          const day=this.getDayGapja(dt);
          const hour=this.getHourPillar(day.stem, dt.getHours());

          return {
            year:{stem:STEMS[yStemIdx],branch:BRANCHES[yBranchIdx]},
            month:{stem:STEMS[mStemIdx],branch:mBranch},
            day, hour
          };
        }

        // ì˜¤í–‰ ì ìˆ˜
        calculateElementScores(){
          const s={ëª©:0,í™”:0,í† :0,ê¸ˆ:0,ìˆ˜:0};
          Object.values(this.pillars).forEach(p=>{ s[STEM_ELEMENTS[p.stem]]+=2; });
          Object.values(this.pillars).forEach(p=>{
            s[BRANCH_ELEMENTS[p.branch]]+=1.5;
            (HIDDEN_STEMS[p.branch]||[]).forEach(h=>{ s[STEM_ELEMENTS[h.stem]]+=h.ratio; });
          });
          s[BRANCH_ELEMENTS[this.pillars.month.branch]]+=2; // ì›”ë ¹ ê°€ì¤‘ì¹˜
          return s;
        }

        // ì‹­ì‹ 
        getTenGod(dayStem,targetStem){
          const dayEl=STEM_ELEMENTS[dayStem], tEl=STEM_ELEMENTS[targetStem];
          const dayYang = STEMS.indexOf(dayStem)%2===0;
          const tYang   = STEMS.indexOf(targetStem)%2===0;
          const same= dayYang===tYang;
          const prod={"ëª©":"í™”","í™”":"í† ","í† ":"ê¸ˆ","ê¸ˆ":"ìˆ˜","ìˆ˜":"ëª©"};
          const ctrl={"ëª©":"í† ","í™”":"ê¸ˆ","í† ":"ìˆ˜","ê¸ˆ":"ëª©","ìˆ˜":"í™”"};
          if(dayEl===tEl) return same?"ë¹„ê²¬":"ê²ì¬";
          if(prod[dayEl]===tEl) return same?"ì‹ì‹ ":"ìƒê´€";
          if(ctrl[dayEl]===tEl) return same?"í¸ì¬":"ì •ì¬";
          if(prod[tEl]===dayEl) return same?"í¸ì¸":"ì •ì¸";
          if(ctrl[tEl]===dayEl) return same?"í¸ê´€":"ì •ê´€";
          return "ë¹„ê²¬";
        }

        // ìš©ì‹  (ì¡°í›„>ì–µë¶€>ë³´ì •)
        determineYongShin(){
          const scores=this.calculateElementScores();
          const dayEl=STEM_ELEMENTS[this.pillars.day.stem];
          const mBr=this.pillars.month.branch;
          let yong=null, reason=[];
          const hot=["ì‚¬","ì˜¤","ë¯¸"], cold=["í•´","ì","ì¶•"];
          if(hot.includes(mBr)){ yong="ìˆ˜"; reason.push("ì—¬ë¦„(í˜¹ì„œ) â†’ ëƒ‰ê°/ìˆ˜ë ´ í•„ìš”"); }
          else if(cold.includes(mBr)){ yong="í™”"; reason.push("ê²¨ìš¸(í˜¹í•œ) â†’ ì˜¨ê¸°/ìƒê¸° í•„ìš”"); }

          const total=Object.values(scores).reduce((a,b)=>a+b,0);
          const avg=total/5; const my=scores[dayEl]; const ratio=my/avg;
          const isStrong=ratio>1.2;
          const strengthDesc = ratio>1.5?"ë§¤ìš° ê°•í•¨": ratio>1.2?"ê°•í•¨": ratio>0.8?"ë³´í†µ": ratio>0.5?"ì•½í•¨":"ë§¤ìš° ì•½í•¨";

          if(!yong){
            const prod={"ëª©":"í™”","í™”":"í† ","í† ":"ê¸ˆ","ê¸ˆ":"ìˆ˜","ìˆ˜":"ëª©"};
            const ctrl={"ëª©":"í† ","í™”":"ê¸ˆ","í† ":"ìˆ˜","ê¸ˆ":"ëª©","ìˆ˜":"í™”"};
            const sortedAsc=Object.entries(scores).sort((a,b)=>a[1]-b[1]).map(x=>x[0]);
            if(isStrong){
              const leak=prod[dayEl];
              yong = sortedAsc.includes(leak)? leak : sortedAsc[0];
              reason.push("ì‹ ê°• â†’ ê¸°ìš´ì„ ë¹¼ê±°ë‚˜(æ³„) ë¶€ì¡± ì˜¤í–‰ ë³´ê°•");
            }else{
              yong = dayEl; reason.push("ì‹ ì•½ â†’ ì¼ê°„ ë³´ê°•");
            }
          }
          const hee = Object.entries(scores).sort((a,b)=>a[1]-b[1]).map(x=>x[0]).filter(el=>el!==yong).slice(0,2);
          return {element:yong, heeShin:hee, reason:reason.join(" / "), isStrong, strengthDesc, strengthRatio:ratio};
        }
      }

      // ===== í† ì •ë¹„ê²°(ë°ëª¨) =====
      class TojeongCalculator{
        constructor(ly,lm,ld){ this.year=ly; this.month=lm; this.day=ld; }
        upper(){const s=this.year.toString().split('').reduce((a,b)=>a+Number(b),0); return ((s-1)%12)+1;}
        middle(){return this.month;}
        lower(){return ((this.day-1)%12)+1;}
        num144(){return (this.upper()-1)*144 + (this.middle()-1)*12 + this.lower();}
        getInterpretation(){
          const n=this.num144(), lv=["ëŒ€ê¸¸","ê¸¸","ì¤‘ê¸¸","ì†Œê¸¸","í‰"][n%5];
          const text={"ëŒ€ê¸¸":"í¬ê²Œ ê¸¸í•˜ì—¬ ì¶”ì§„/í™•ì¥ì— ìœ ë¦¬","ê¸¸":"ì¢‹ì€ íë¦„, ê³„íšëŒ€ë¡œ ì§„í–‰","ì¤‘ê¸¸":"í‰ê·  ì´ìƒ, ì‹ ì¤‘íˆ ì „ì§„","ì†Œê¸¸":"ì‘ê²Œ ì´ë“, ë¬´ë¦¬ë§ ê²ƒ","í‰":"ì•ˆì • ìœ ì§€, ë‚´ì‹¤ ë‹¤ì§€ê¸°"}[lv];
          return {level:lv, desc:text, guaNumber:n};
        }
        monthly(){
          const base=this.num144(), lvArr=["ëŒ€ê¸¸","ê¸¸","ì¤‘ê¸¸","ì†Œê¸¸","í‰"], themes=["ìƒˆë¡œìš´ ì‹œì‘","ê´€ê³„ ë°œì „","ì¬ë¬¼ ì¦ê°€","ê±´ê°• ì£¼ì˜","í•™ì—… ì„±ì·¨","ì—¬í–‰ ê¸°íšŒ","ê°€ì¡± í™”í•©","ì‚¬ì—… í™•ì¥","ì¸ì—° ë§Œë‚¨","ìŠ¹ì§„ ê¸°íšŒ","íˆ¬ì ì‹ ì¤‘","ë§ˆë¬´ë¦¬ ì •ë¦¬"];
          const advice={"ëŒ€ê¸¸":"ì ê·¹ ë„ì „","ê¸¸":"ê³„íšëŒ€ë¡œ ì§„í–‰","ì¤‘ê¸¸":"ì‹ ì¤‘ ì ‘ê·¼","ì†Œê¸¸":"ì‘ì€ ë§Œì¡±","í‰":"í˜„ìƒ ìœ ì§€"};
          const arr=[]; for(let m=1;m<=12;m++){ const lv=lvArr[(base+m)%5]; arr.push({month:m, level:lv, theme:themes[m-1], advice:advice[lv]}); }
          return arr;
        }
      }

      // ===== ë¶„ì„ ì‹¤í–‰ =====
      const handleAnalysis=()=>{
        try{
          setLoading(true); setError(null);
          const birth=new Date(formData.year,formData.month-1,formData.day,formData.hour,formData.minute);
          if(isNaN(birth.getTime())) throw new Error("ì˜¬ë°”ë¥¸ ë‚ ì§œÂ·ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

          const saju=new SajuCalculator(birth, formData.gender, formData.calendar==='lunar');
          const elementScores=saju.calculateElementScores();
          const yongShin=saju.determineYongShin();

          const dayStem=saju.pillars.day.stem;
          const tenGods={}; ["year","month","hour"].forEach(k=> tenGods[k]=saju.getTenGod(dayStem, saju.pillars[k].stem));
          const branches=[saju.pillars.year.branch, saju.pillars.month.branch, saju.pillars.day.branch, saju.pillars.hour.branch];
          const sinsals=[]; Object.entries(SINSALS).forEach(([name,obj])=>{
            if(obj.check(dayStem, branches)) sinsals.push({name, desc:obj.desc, detail:obj.detail});
          });

          const lunar = formData.calendar==='lunar' ? {year:formData.year,month:formData.month,day:formData.day} : new LunarConverter().toLunar(formData.year,formData.month,formData.day);
          const tj=new TojeongCalculator(lunar.year,lunar.month,lunar.day);

          setResult({
            saju:saju.pillars,
            elementScores, yongShin, tenGods, sinsals,
            tojeong:{upper:tj.upper(),middle:tj.middle(),lower:tj.lower(),interpretation:tj.getInterpretation(),monthly:tj.monthly()},
            birthInfo:{solar: formData.calendar==='solar'? birth : saju.solarDate, lunar}
          });
          setActiveTab('basic');
        }catch(e){ setError(e.message||String(e)); }
        finally{ setLoading(false); }
      };

      // ===== ì°¨íŠ¸: resultê°€ ë°”ë€” ë•Œ ë§ˆë‹¤ ì•ˆì „í•˜ê²Œ ìƒì„±/í•´ì œ =====
      React.useEffect(()=>{
        if(!result || !result.elementScores) return;
        const ctx = chartRef.current?.getContext?.('2d');
        if(!ctx) return;
        if(chartInstanceRef.current){ chartInstanceRef.current.destroy(); chartInstanceRef.current=null; }
        chartInstanceRef.current = new Chart(ctx,{
          type:'radar',
          data:{
            labels:ELEMENTS,
            datasets:[{
              label:'ì˜¤í–‰ ì ìˆ˜',
              data:ELEMENTS.map(el=>result.elementScores[el]),
              backgroundColor:'rgba(102,126,234,0.3)',
              borderColor:'rgba(102,126,234,1)',
              borderWidth:2
            }]
          },
          options:{
            responsive:true, maintainAspectRatio:false,
            scales:{ r:{ beginAtZero:true,
              ticks:{color:'#666'}, grid:{color:'#ddd'},
              pointLabels:{color:'#333',font:{size:14,weight:'bold'}}
            }},
            plugins:{legend:{display:false}}
          }
        });
        return ()=>{ if(chartInstanceRef.current){ chartInstanceRef.current.destroy(); chartInstanceRef.current=null; } };
      },[result]);

      // ===== ë Œë”ë§ ìœ í‹¸ =====
      const getElementClass=(stem)=>{
        const el=STEM_ELEMENTS[stem];
        return {"ëª©":"element-wood","í™”":"element-fire","í† ":"element-earth","ê¸ˆ":"element-metal","ìˆ˜":"element-water"}[el]||"";
      };

      // ===== ì…ë ¥ í¼ =====
      const renderInputForm=()=>(
        <div className="glass-card p-8 max-w-2xl mx-auto slide-in">
          <h2 className="text-3xl font-bold text-gray-800 mb-2 text-center">ì‚¬ì£¼ëª…ë¦¬ & í† ì •ë¹„ê²° ë¶„ì„</h2>
          <p className="text-gray-600 text-center mb-6">ìƒë…„ì›”ì¼ì‹œë¥¼ ì…ë ¥í•˜ì—¬ ì •í™•í•œ ìš´ì„¸ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
          {error && <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">{error}</div>}
          <div className="space-y-4">
            <div className="flex justify-center gap-4 mb-4">
              <label className="flex items-center"><input type="radio" name="calendar" value="solar" checked={formData.calendar==='solar'} onChange={e=>setFormData({...formData,calendar:e.target.value})} className="mr-2"/>ì–‘ë ¥</label>
              <label className="flex items-center"><input type="radio" name="calendar" value="lunar" checked={formData.calendar==='lunar'} onChange={e=>setFormData({...formData,calendar:e.target.value})} className="mr-2"/>ìŒë ¥</label>
            </div>

            <div className="grid grid-cols-3 gap-3">
              <div><label className="block text-gray-700 text-sm font-bold mb-2">ë…„ë„</label>
                <input type="number" min="1900" max="2100" value={formData.year} onChange={e=>setFormData({...formData,year:parseInt(e.target.value)||1990})} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500"/></div>
              <div><label className="block text-gray-700 text-sm font-bold mb-2">ì›”</label>
                <select value={formData.month} onChange={e=>setFormData({...formData,month:parseInt(e.target.value)})} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                  {[...Array(12)].map((_,i)=><option key={i+1} value={i+1}>{i+1}ì›”</option>)}
                </select></div>
              <div><label className="block text-gray-700 text-sm font-bold mb-2">ì¼</label>
                <select value={formData.day} onChange={e=>setFormData({...formData,day:parseInt(e.target.value)})} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                  {[...Array(31)].map((_,i)=><option key={i+1} value={i+1}>{i+1}ì¼</option>)}
                </select></div>
            </div>

            <div className="grid grid-cols-3 gap-3">
              <div><label className="block text-gray-700 text-sm font-bold mb-2">ì‹œê°„</label>
                <select value={formData.hour} onChange={e=>setFormData({...formData,hour:parseInt(e.target.value)})} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                  {[...Array(24)].map((_,i)=><option key={i} value={i}>{i}ì‹œ</option>)}
                </select></div>
              <div><label className="block text-gray-700 text-sm font-bold mb-2">ë¶„</label>
                <select value={formData.minute} onChange={e=>setFormData({...formData,minute:parseInt(e.target.value)})} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                  {[0,15,30,45].map(m=><option key={m} value={m}>{m}ë¶„</option>)}
                </select></div>
              <div><label className="block text-gray-700 text-sm font-bold mb-2">ì„±ë³„</label>
                <select value={formData.gender} onChange={e=>setFormData({...formData,gender:e.target.value})} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                  <option value="ë‚¨">ë‚¨ì„±</option><option value="ì—¬">ì—¬ì„±</option>
                </select></div>
            </div>

            <button onClick={handleAnalysis} disabled={loading} className="w-full py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
              {loading? (<div className="flex items-center justify-center"><div className="spinner mr-2"></div><span>ë¶„ì„ ì¤‘...</span></div>):'ğŸ”® ìš´ì„¸ ë¶„ì„í•˜ê¸°'}
            </button>
          </div>
        </div>
      );

      // ===== ì‚¬ì£¼ ë¶„ì„ íƒ­ =====
      const renderBasicAnalysis=()=>{
        if(!result) return null;
        const labels=['ì—°ì£¼ (ì¡°ìƒ/ìœ ë…„)','ì›”ì£¼ (ë¶€ëª¨/ì²­ë…„)','ì¼ì£¼ (ë³¸ì¸)','ì‹œì£¼ (ìë…€/ë…¸ë…„)'];
        return (
          <div className="space-y-6 slide-in">
            <div className="glass-card p-6">
              <h3 className="text-2xl font-bold text-gray-800 mb-4">ğŸ“¿ ì‚¬ì£¼íŒ”ì ë¶„ì„</h3>
              <div className="grid grid-cols-4 gap-4 mb-6">
                {['year','month','day','hour'].map((pillar,idx)=>{
                  const p=result.saju[pillar]; const isDay=pillar==='day';
                  const tenGod = !isDay? result.tenGods[pillar]:null;
                  const info = tenGod? TEN_GODS_MAP[tenGod]:null;
                  return (
                    <div key={pillar} className="text-center bg-gray-50 rounded-lg p-4">
                      <div className="text-xs text-gray-600 mb-2">{labels[idx]}</div>
                      <div className={`text-3xl font-bold mb-1 ${getElementClass(p.stem)} ${isDay?'ring-2 ring-purple-400 rounded-lg p-1':''}`}>{p.stem}</div>
                      <div className={`text-3xl font-bold ${getElementClass(p.stem)}`}>{p.branch}</div>
                      {tenGod && (
                        <div className="mt-2">
                          <span className="tooltip">
                            <span className="text-sm text-blue-600 font-semibold">{tenGod}</span>
                            <span className="tooltip-text"><strong>{tenGod}</strong><br/>{info.desc}<br/><small>{info.tip}</small></span>
                          </span>
                        </div>
                      )}
                      <div className="mt-2 text-xs text-gray-500">
                        {(HIDDEN_STEMS[p.branch]||[]).map((h,i)=><span key={i} className="mx-1">{h.stem}<sub>{h.type}</sub></span>)}
                      </div>
                    </div>
                  );
                })}
              </div>

              <div className="bg-purple-50 rounded-lg p-4">
                <h4 className="font-bold text-gray-800 mb-2">ğŸ’« ë‚˜ì˜ ê¸°ë³¸ ì„±ê²©</h4>
                <p className="text-gray-700">
                  ì¼ê°„ <span className="font-bold text-purple-600">{result.saju.day.stem}({STEM_ELEMENTS[result.saju.day.stem]})</span>ì€&nbsp;
                  {({
                    "ê°‘":"ì”©ì”©í•˜ê³  ë¦¬ë”ì‹­ì´ ê°•í•˜ë©°, ì •ì˜ê°ì´ íˆ¬ì² í•©ë‹ˆë‹¤",
                    "ì„":"ìœ ì—°í•˜ê³  ì ì‘ë ¥ì´ ë›°ì–´ë‚˜ë©°, ì„¬ì„¸í•œ ê°ì„±ì„ ê°€ì¡ŒìŠµë‹ˆë‹¤",
                    "ë³‘":"ë°ê³  í™œë°œí•˜ë©°, ì—´ì •ì ì´ê³  í‘œí˜„ë ¥ì´ í’ë¶€í•©ë‹ˆë‹¤",
                    "ì •":"ë”°ëœ»í•˜ê³  ì˜¨í™”í•˜ë©°, ì„¸ì‹¬í•˜ê³  ë°°ë ¤ì‹¬ì´ ê¹ŠìŠµë‹ˆë‹¤",
                    "ë¬´":"ë“ ë“ í•˜ê³  í¬ìš©ë ¥ì´ í¬ë©°, ì‹ ë¢°ê°ì„ ì¤ë‹ˆë‹¤",
                    "ê¸°":"ì‹¤ìš©ì ì´ê³  í˜„ì‹¤ì ì´ë©°, ê¼¼ê¼¼í•˜ê³  ì„±ì‹¤í•©ë‹ˆë‹¤",
                    "ê²½":"ê²°ë‹¨ë ¥ì´ ìˆê³  ì¶”ì§„ë ¥ì´ ê°•í•˜ë©°, ì›ì¹™ì„ ì¤‘ì‹œí•©ë‹ˆë‹¤",
                    "ì‹ ":"ì˜ˆë¦¬í•˜ê³  ì •í™•í•˜ë©°, ì™„ë²½ì£¼ì˜ ì„±í–¥ì´ ìˆìŠµë‹ˆë‹¤",
                    "ì„":"ì§€í˜œë¡­ê³  ìœ ì—°í•˜ë©°, ì†Œí†µëŠ¥ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤",
                    "ê³„":"ì´ëª…í•˜ê³  ê¸°íšë ¥ì´ ë›°ì–´ë‚˜ë©°, ì§ê´€ë ¥ì´ ê°•í•©ë‹ˆë‹¤"
                  }[result.saju.day.stem]||"ë…íŠ¹í•œ ê°œì„±ì„ ê°€ì¡ŒìŠµë‹ˆë‹¤")}.</p>
              </div>
            </div>

            <div className="glass-card p-6">
              <h3 className="text-2xl font-bold text-gray-800 mb-4">âš–ï¸ ì˜¤í–‰ ì—ë„ˆì§€ ë¶„ì„</h3>
              <div className="mb-4" style={{height:'300px'}}>
                <canvas ref={chartRef} id="elementChart"></canvas>
              </div>

              <div className="space-y-2 mb-4">
                {ELEMENTS.map(el=>{
                  const score=result.elementScores[el];
                  const max=Math.max(...Object.values(result.elementScores));
                  const pct=(score/max)*100;
                  const color={"ëª©":"bg-green-500","í™”":"bg-red-500","í† ":"bg-yellow-500","ê¸ˆ":"bg-gray-500","ìˆ˜":"bg-blue-500"}[el];
                  return (
                    <div key={el} className="flex items-center">
                      <div className="w-12 font-bold">{el}</div>
                      <div className="flex-1 bg-gray-200 rounded-full h-6 relative">
                        <div className={`${color} rounded-full h-6 transition-all duration-500`} style={{width:`${pct}%`}}></div>
                        <span className="absolute right-2 top-0 h-6 flex items-center text-sm">{score.toFixed(1)}ì </span>
                      </div>
                    </div>
                  );
                })}
              </div>

              <div className="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg p-4">
                <h4 className="font-bold text-gray-800 mb-2">ğŸ¯ ìš©ì‹  ë¶„ì„ (ìš´ì„ ë•ëŠ” í•µì‹¬)</h4>
                <div className="grid grid-cols-2 gap-4 mb-3">
                  <div><span className="text-sm text-gray-600">ì¼ê°„ ê°•ì•½:</span><span className="ml-2 font-bold text-lg">{result.yongShin.strengthDesc}</span></div>
                  <div><span className="text-sm text-gray-600">ìš©ì‹ :</span><span className="ml-2 font-bold text-lg text-purple-600">{result.yongShin.element}</span></div>
                </div>
                <p className="text-gray-700 mb-3">{result.yongShin.reason}. ìš©ì‹  '{result.yongShin.element}'ì„(ë¥¼) ìƒí™œì— ì ê·¹ ë°˜ì˜í•˜ë©´ ìš´ì´ ìƒìŠ¹í•©ë‹ˆë‹¤.</p>
                <div className="bg-white rounded-lg p-3">
                  <h5 className="font-semibold text-sm mb-2">ğŸ’¡ ì‹¤ìƒí™œ ì ìš©ë²•</h5>
                  {({
                    "ëª©":["ğŸŒ³ ë…¹ìƒ‰ ì‚¬ìš©","ğŸŒ… ë™ìª½ ê¸°ìš´","ğŸŒ± ì‹ë¬¼/ì‚°ì±…","ğŸ“š í•™ìŠµÂ·ì„±ì¥ ë£¨í‹´"],
                    "í™”":["ğŸ”´ ë¹¨ê°•/ì£¼í™©","â˜€ï¸ ë‚¨ìª½ ê¸°ìš´","ğŸƒ ìš´ë™/ë°œí‘œ","ğŸ’¡ ì°½ì˜ì  í‘œí˜„"],
                    "í† ":["ğŸŸ¡ ë…¸ë‘Â·ë² ì´ì§€","ğŸ  ì¤‘ì•™ ì•ˆì •","âš–ï¸ ë£¨í‹´Â·ê· í˜•","ğŸ¤ ì¤‘ì¬/ê´€ë¦¬"],
                    "ê¸ˆ":["âšª í°ìƒ‰/ë©”íƒˆ","ğŸŒ† ì„œìª½ ê¸°ìš´","ğŸ“‹ ì •ë¦¬/ê¸°ì¤€","â° ê·œì¹™ì  ìƒí™œ"],
                    "ìˆ˜":["ğŸ”µ íŒŒë‘/ê²€ì •","ğŸŒŠ ë¶ìª½ ê¸°ìš´","ğŸ’§ ìˆ˜ë¶„/ë³´ì˜¨","ğŸ§  ì—°êµ¬Â·ê¸°íš"]
                  }[result.yongShin.element]||["ê· í˜• ìœ ì§€"]).map((t,i)=><div key={i} className="text-sm text-gray-700">{t}</div>)}
                  {result.yongShin.heeShin?.length>0 && (
                    <div className="text-xs text-gray-500 mt-2">ë³´ì¡°(í¬ì‹ ): {result.yongShin.heeShin.join(" Â· ")}</div>
                  )}
                </div>
              </div>
            </div>

            {result.sinsals.length>0 && (
              <div className="glass-card p-6">
                <h3 className="text-2xl font-bold text-gray-800 mb-4">ğŸŒŸ íŠ¹ë³„í•œ ì‹ ì‚´</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                  {result.sinsals.map((s,i)=>(
                    <div key={i} className="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg p-4">
                      <h4 className="font-bold text-orange-600 mb-1">{s.name}</h4>
                      <p className="text-sm text-gray-600 mb-1">{s.desc}</p>
                      <p className="text-xs text-gray-500">{s.detail}</p>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        );
      };

      // ===== í† ì •ë¹„ê²° íƒ­ =====
      const renderTojeongAnalysis=()=>{
        if(!result||!result.tojeong) return null;
        const tj=result.tojeong;
        return (
          <div className="space-y-6 slide-in">
            <div className="glass-card p-6">
              <h3 className="text-2xl font-bold text-gray-800 mb-4">ğŸ´ í† ì •ë¹„ê²° ìš´ì„¸</h3>
              <div className="grid grid-cols-3 gap-4 mb-6">
                <div className="text-center bg-gradient-to-br from-red-50 to-pink-50 rounded-lg p-4">
                  <div className="text-sm text-gray-600 mb-1">ìƒê´˜ (ë…„)</div>
                  <div className="text-4xl font-bold text-red-500">{tj.upper}</div>
                  <div className="text-xs text-gray-500 mt-1">ì „ì²´ ìš´ì˜ ê¸°ì¡°</div>
                </div>
                <div className="text-center bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4">
                  <div className="text-sm text-gray-600 mb-1">ì¤‘ê´˜ (ì›”)</div>
                  <div className="text-4xl font-bold text-blue-500">{tj.middle}</div>
                  <div className="text-xs text-gray-500 mt-1">í˜„ì¬ ìƒí™©</div>
                </div>
                <div className="text-center bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-4">
                  <div className="text-sm text-gray-600 mb-1">í•˜ê´˜ (ì¼)</div>
                  <div className="text-4xl font-bold text-green-500">{tj.lower}</div>
                  <div className="text-xs text-gray-500 mt-1">êµ¬ì²´ì  ì‹¤ì²œ</div>
                </div>
              </div>

              <div className={`rounded-lg p-4 mb-6 ${
                tj.interpretation.level==='ëŒ€ê¸¸'?'bg-green-50':
                tj.interpretation.level==='ê¸¸'   ?'bg-blue-50':
                tj.interpretation.level==='ì¤‘ê¸¸' ?'bg-yellow-50':'bg-gray-50'}`}>
                <div className="flex items-center justify-between mb-2">
                  <h4 className="font-bold text-lg">ì¢…í•© ìš´ì„¸</h4>
                  <span className={`px-3 py-1 rounded-full text-white font-bold ${
                    tj.interpretation.level==='ëŒ€ê¸¸'?'bg-green-500':
                    tj.interpretation.level==='ê¸¸'  ?'bg-blue-500':
                    tj.interpretation.level==='ì¤‘ê¸¸'?'bg-yellow-500':'bg-gray-500'}`}>
                    {tj.interpretation.level}
                  </span>
                </div>
                <p className="text-gray-700">{tj.interpretation.desc}</p>
                <p className="text-gray-600 text-sm mt-1">â€» ëª…ë¦¬ ì—°ê²°: ìš©ì‹ /í¬ì‹ ê³¼ ë§ë¬¼ë¦¬ëŠ” ì›”ì— ì§‘ì¤‘í•˜ë©´ ê¸¸ìš´ì„ í˜„ì‹¤í™”í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤.</p>
              </div>

              <div>
                <h4 className="font-bold text-lg mb-3">ğŸ“… 2025ë…„ ì›”ë³„ ìš´ì„¸</h4>
                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                  {tj.monthly.map(m=>(
                    <div key={m.month} className="bg-white rounded-lg p-3 border border-gray-200">
                      <div className="flex items-center justify-between mb-1">
                        <span className="font-bold">{m.month}ì›”</span>
                        <span className={`text-xs px-2 py-1 rounded ${
                          m.level==='ëŒ€ê¸¸'?'bg-green-100 text-green-700':
                          m.level==='ê¸¸'  ?'bg-blue-100 text-blue-700':
                          m.level==='ì¤‘ê¸¸'?'bg-yellow-100 text-yellow-700':'bg-gray-100 text-gray-700'}`}>{m.level}</span>
                      </div>
                      <div className="text-sm text-gray-600">{m.theme}</div>
                      <div className="text-xs text-gray-500 mt-1">{m.advice}</div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        );
      };

      // ===== ì¡°ì–¸ íƒ­ =====
      const renderAdvice=()=>{
        if(!result) return null;
        const weakest = Object.entries(result.elementScores).sort((a,b)=>a[1]-b[1])[0][0];
        const dirMap={ëª©:"ë™ìª½",í™”:"ë‚¨ìª½",í† :"ì¤‘ì•™",ê¸ˆ:"ì„œìª½",ìˆ˜:"ë¶ìª½"};
        return (
          <div className="space-y-6 slide-in">
            <div className="glass-card p-6">
              <h3 className="text-2xl font-bold text-gray-800 mb-4">ğŸ’¡ ë§ì¶¤í˜• ì¸ìƒ ì¡°ì–¸</h3>

              <div className="mb-6">
                <h4 className="font-bold text-lg mb-3 text-purple-600">ì„±ê²©ê³¼ ì¬ëŠ¥</h4>
                <div className="bg-purple-50 rounded-lg p-4">
                  <p className="text-gray-700 mb-2">
                    {({
                      "ëª©":"ì°½ì˜Â·ë¦¬ë”ì‹­ì´ ê°•í•´ ì‹œì‘ê³¼ ì„±ì¥ì— ìœ ë¦¬. êµìœ¡Â·ì˜ˆìˆ Â·í™˜ê²½ ë¶„ì•¼ ì¶”ì²œ.",
                      "í™”":"ì—´ì •Â·í‘œí˜„ë ¥ì´ í’ë¶€. ëŒ€ì¤‘ ì†Œí†µ/ë§ˆì¼€íŒ…/ìŠ¤í¬ì¸ ì— ê°•ì .",
                      "í† ":"ì•ˆì •Â·ê´€ë¦¬ ì—­ëŸ‰ íƒì›”. ê²½ì˜Â·ë¶€ë™ì‚°Â·ì¬ë¬´ì— ì í•©.",
                      "ê¸ˆ":"ì •í™•Â·ì›ì¹™ ì¤‘ì‹œ. ë²•ë¥ Â·íšŒê³„Â·ê³µí•™ ë“± ì „ë¬¸ì§ ìœ ë¦¬.",
                      "ìˆ˜":"ì§€í˜œÂ·ìœ ì—°ì„± ë†’ê³  ë³€í™” ëŒ€ì‘ ìš°ìˆ˜. ITÂ·ì—°êµ¬Â·ì»¨ì„¤íŒ…ì— ê°•ì ."
                    }[STEM_ELEMENTS[result.saju.day.stem]])}
                  </p>
                </div>
              </div>

              <div className="mb-6">
                <h4 className="font-bold text-lg mb-3 text-green-600">ê±´ê°• ê´€ë¦¬</h4>
                <div className="bg-green-50 rounded-lg p-4">
                  <p className="text-gray-700">
                    {({
                      "ëª©":"ê°„/ë‹´Â·ëˆˆ ê´€ë¦¬. ìŠ¤íŠ¸ë ˆìŠ¤ ì™„í™”Â·ìˆ˜ë©´Â·ë…¹ì±„ì†Œ ì„­ì·¨.",
                      "í™”":"ì‹¬í˜ˆÂ·í˜ˆê´€ ê´€ë¦¬. ê³¼ë¡œ ê¸ˆì§€Â·ê·œì¹™ ìš´ë™ìœ¼ë¡œ ìˆœí™˜ ê°œì„ .",
                      "í† ":"ì†Œí™”ê¸° ê´€ë¦¬. ê·œì¹™ ì‹ì‚¬Â·ê°€ë²¼ìš´ ìœ ì‚°ì†Œë¡œ ì²´ì¤‘ ì¡°ì ˆ.",
                      "ê¸ˆ":"í˜¸í¡ê¸°/í”¼ë¶€ ê´€ë¦¬. ì‹¤ë‚´ ê³µê¸°Â·ìˆ˜ë¶„ ë³´ì¶© ì¤‘ìš”.",
                      "ìˆ˜":"ì‹ ì¥/ë°©ê´‘ ê´€ë¦¬. ìˆ˜ë¶„ ì„­ì·¨Â·ë³´ì˜¨ì— ì‹ ê²½ ì“¸ ê²ƒ."
                    }[weakest])}
                  </p>
                </div>
              </div>

              <div>
                <h4 className="font-bold text-lg mb-3 text-orange-600">2025ë…„ ì„ì‚¬ë…„ íŠ¹ë³„ ì¡°ì–¸</h4>
                <div className="bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg p-4">
                  <div className="space-y-2 text-gray-700">
                    <p>ğŸ <strong>ì„ì‚¬ë…„</strong>: ì‹ ì¤‘í•œ íŒë‹¨ê³¼ ì „ëµì´ ë¹›ë‚˜ëŠ” í•´.</p>
                    <ul className="space-y-1 ml-4">
                      <li>â€¢ ìƒë°˜ê¸°: ì¤€ë¹„Â·ê³„íš | í•˜ë°˜ê¸°: ì‹¤í–‰Â·ìˆ˜í™•</li>
                      <li>â€¢ í•µì‹¬ í‚¤ì›Œë“œ: ì¸ë‚´ Â· ì§€í˜œ Â· ë³€í™”</li>
                      <li>â€¢ í–‰ìš´ì˜ ë°©í–¥: {dirMap[result.yongShin.element]}</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // ===== Main Layout =====
      return (
        <div className="min-h-screen py-8 px-4">
          <div className="max-w-6xl mx-auto">
            <header className="text-center mb-8">
              <h1 className="text-4xl md:text-5xl font-bold text-white mb-3">ğŸ”® ì‚¬ì£¼ëª…ë¦¬ & í† ì •ë¹„ê²°</h1>
              <p className="text-white/80 text-lg">ë™ì–‘ ì² í•™ì´ ë°í˜€ì£¼ëŠ” ë‹¹ì‹ ì˜ ìš´ëª…ê³¼ ë¯¸ë˜</p>
            </header>

            {result && (
              <div className="flex flex-wrap justify-center gap-2 mb-8 no-print">
                <button onClick={()=>setActiveTab('basic')} className={`px-4 py-2 rounded-lg font-semibold transition-all ${activeTab==='basic'?'tab-active':'bg-white/80 hover:bg-white/90'}`}>ğŸ“¿ ì‚¬ì£¼ë¶„ì„</button>
                <button onClick={()=>setActiveTab('tojeong')} className={`px-4 py-2 rounded-lg font-semibold transition-all ${activeTab==='tojeong'?'tab-active':'bg-white/80 hover:bg-white/90'}`}>ğŸ´ í† ì •ë¹„ê²°</button>
                <button onClick={()=>setActiveTab('advice')} className={`px-4 py-2 rounded-lg font-semibold transition-all ${activeTab==='advice'?'tab-active':'bg-white/80 hover:bg-white/90'}`}>ğŸ’¡ ì¸ìƒì¡°ì–¸</button>
              </div>
            )}

            <div className="min-h-[400px]">
              {!result && renderInputForm()}
              {result && activeTab==='basic' && renderBasicAnalysis()}
              {result && activeTab==='tojeong' && renderTojeongAnalysis()}
              {result && activeTab==='advice' && renderAdvice()}
            </div>

            {result && (
              <div className="mt-8 text-center space-x-4 no-print">
                <button onClick={()=>{setResult(null); setActiveTab('input');}} className="px-6 py-2 bg-white/80 text-gray-700 rounded-lg hover:bg-white/90 transition-all">â†©ï¸ ë‹¤ì‹œ ë¶„ì„</button>
                <button onClick={()=>window.print()} className="px-6 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all">ğŸ“„ ì¸ì‡„/ì €ì¥</button>
              </div>
            )}
          </div>
        </div>
      );
    };

    // React 17 ë°©ì‹ìœ¼ë¡œ ë§ˆìš´íŠ¸ (ì¤‘ìš”!)
    ReactDOM.render(<App/>, document.getElementById('root'));
  </script>
</body>
</html>
